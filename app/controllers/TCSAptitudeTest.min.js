angular.module("etest").controller("TCSAptitudeTestController",["$scope","$rootScope","$http","$timeout","aptitudeTest","$location","$stateParams","login","header",function(e,t,n,s,r,o,a,i,u){u.setTitle("e-test: Online TCS Analytical Ability Test for Free"),e.apt=!0,e.exam="TCS",e.examStatus=!0,e.set=a.setId,(e.set<=0||e.set>3||!e.set)&&o.path("/error"),e.first=!0,e.last=!1,e.fetchingAptQuestions=!0,e.time=4800,e.minutes=80,e.seconds="00",e.mark=1,e.starMark=2,e.factor=3,e.showInstructions=!0,e.showReport=!1,e.score=0,e.donutData=[],e.questions=[],e.individualGraphType="spline",e.userTestData=[],e.allUserData=[],e.wasLogged=t.user?!0:!1,r.getTCSAptitudeQuestions({company:e.exam,section:"",set:e.set,lod:""},e),t.user?r.getTCSAptitudeData({username:t.user.username,exam:e.exam,set:e.set},e):alertify.error("You are not <b>logged</b> in, Please login first!"),e.logme=function(){i.login()},e.previous=function(){e.getQuestion(e.currentQuestion.id-1)},e.next=function(){e.getQuestion(e.currentQuestion.id+1)},e.getQuestion=function(t){t-1==e.questions.length&&(t=1),e.currentQuestion={id:e.questions[t-1].id,question:e.questions[t-1].question,option1:e.questions[t-1].option1,option2:e.questions[t-1].option2,option3:e.questions[t-1].option3,option4:e.questions[t-1].option4,ans:e.questions[t-1].ans,mr:e.questions[t-1].mr},e.last=e.currentQuestion.id==e.questions.length?!0:!1,e.first=1==e.currentQuestion.id?!0:!1,e.selected=e.currentQuestion.ans},e.change=function(t){console.log(t+"  id"),e.currentQuestion.ans=t},e.markForReview=function(){e.currentQuestion.mr&&alertify.success("Question "+e.currentQuestion.id+" marked for review!")},e.submitAnswer=function(){var t=e.currentQuestion.id;t--,e.questions[t].ans=e.currentQuestion.ans,e.questions[t].mr=e.currentQuestion.mr,console.log(e.questions[t].ans),e.next()},e.reset=function(){var t=e.currentQuestion.id;t--,e.questions[t].ans=0,e.questions[t].mr=!1,e.getQuestion(t+1),e.selected=0},e.skip=function(){e.next()},e.setQuestion=function(){},e.startTest=function(){},e.endTest=function(){alertify.set({labels:{ok:"Yes",cancel:"No"}}),alertify.set({buttonReverse:!0}),alertify.set({buttonFocus:"cancel"});var t="<div class='offer offer-success'><div class='shape'><div class='shape-text'>Summary </div></div><div class='offer-content'>	<h3 class='lead text-center'>	Summary</h3>	<p class='text-justify'>Answered : "+e.getAnswered()+"<br/> Answered &amp; Marked for Review : "+e.getAnsweredMarked()+"<br/> Unanswered :"+e.getUnAnswered()+"</p><p><span class='text-center text-primary'>Are you sure, you want to exit the test?</span></p>			</div></div>";alertify.confirm(t,function(t){t&&(e.time=-1,e.evaluate())})},e.startTime=function(){return e.time%60<10?(e.minutes=parseInt(e.time/60),e.seconds="0"+e.time%60):(e.minutes=parseInt(e.time/60),e.seconds=e.time%60),e.time<=0?void(0==e.time&&e.evaluate()):(e.timer=s(e.startTime.bind(this),1e3),void(e.time-=1))},e.endTime=function(){e.time=0},e.countTime=function(){},e.getAnsweredMarked=function(){for(var t=0,n=0;n<e.questions.length;n++)e.questions[n].ans>0&&e.questions[n].mr&&t++;return t},e.getAnswered=function(){for(var t=0,n=0;n<e.questions.length;n++)e.questions[n].ans>0&&!e.questions[n].mr&&t++;return t},e.getUnAnswered=function(){for(var t=0,n=0;n<e.questions.length;n++)0==e.questions[n].ans&&t++;return t},e.getCorrect=function(){for(var t=0,n=0;n<e.questions.length;n++)e.questions[n].ans==e.questions[n].answer&&t++;return t},e.getInCorrect=function(){for(var t=0,n=0;n<e.questions.length;n++)e.questions[n].ans>0&&e.questions[n].ans!=e.questions[n].answer&&t++;return t},e.evaluate=function(){e.examStatus=!1;for(var n=0,o=0;o<e.questions.length;o++)0!=e.questions[o].ans&&(e.questions[o].ans==e.questions[o].answer?n+=e.questions[o].star?e.starMark:e.mark:n-=(e.questions[o].star?e.starMark:e.mark)/e.factor,n=Math.round(100*n)/100);return e.showReport=!0,s(function(){e.visualize()},200),s(function(){e.draw("spline"),e.drawRankGraph("line"),e.visualize(),window.scrollTo(0,0)},200),e.score=n,e.getDonutData(),r.saveTCSAptitudeResult({username:t.user.username,score:parseFloat(100*n)/parseFloat(4*(30-e.countStarred())+6*e.countStarred()),exam:e.exam,set:e.set},e),e.userTestData.push({s:parseFloat(100*n)/parseFloat(4*(30-e.countStarred())+6*e.countStarred())}),n},e.hideInstructions=function(){if(!t.user){alertify.set({labels:{ok:"<div class='primary'><i class='fa fa-facebook'></i>Login with Facebook</div>",cancel:"Cancel"}}),alertify.set({buttonReverse:!0}),alertify.set({buttonFocus:"ok"});var n="<div class='alert alert-danger' role='alert'><b>Oh snap!</b> You are not logged in, login and try again.</div>";return void alertify.confirm(n,function(t){t?e.logme():alertify.error("You are not <b>logged</b> in, Please login first!")})}e.fetchingAptQuestions?alertify.error("Questions are being loaded, please wait a while!"):(e.showInstructions=!1,e.getQuestion(1),e.startTime(),e.wasLogged||r.getTCSAptitudeData({username:t.user.username,exam:e.exam,set:e.set},e))},e.visualize=function(){$("#aptitudeReport").highcharts({chart:{type:"pie",options3d:{enabled:!0,alpha:45}},title:{text:"Performance Analysis"},subtitle:{text:"Analytical Test"},plotOptions:{pie:{innerSize:100,depth:45}},series:[{name:"Count",data:e.donutData}]}),$("#aptitudeReport text").last().html("Programming Geek").click(function(e){e.preventDefault(),window.location="http://www.programminggeek.in"})},e.draw=function(t){var n="Performance Analysis",s=e.exam,r=[{name:e.exam+"("+e.set+")",data:e.formatData(e.userTestData)}];if("3d column"==t){var o={renderTo:"container",type:"column",margin:75,options3d:{enabled:!0,alpha:15,beta:15,depth:50,viewDistance:25}};e.cummulativeRanking(o,"individualRanking",r,n,s,"Time (Test Taken)","Score")}else e.cummulativeRanking({type:t},"individualRanking",r,n,s,"Time (Test Taken)","Score");$(window).scrollTop($("#individualRanking").offset().top)},e.drawRankGraph=function(t){var n="Rank Analysis",s=e.exam;if("3d column"==t){var r={renderTo:"container",type:"column",margin:75,options3d:{enabled:!0,alpha:15,beta:15,depth:50,viewDistance:25}};e.cummulativeRanking(r,"overallRanking",e.getRankSeries(e.allUserData),n,s,"Rank","Score")}else e.cummulativeRanking({type:t},"overallRanking",e.getRankSeries(e.allUserData),n,s,"Rank","Score");$(window).scrollTop($("#overallRanking").offset().top)},e.cummulativeRanking=function(e,t,n,s,r,o,a){$("#"+t).highcharts({chart:e,title:{text:s},subtitle:{text:r},xAxis:{categories:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],title:{text:o}},yAxis:{title:{text:a+" (in %)"},min:0,minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null,plotBands:[{from:0,to:50,color:"#f2dede",label:{text:"Poor",style:{color:"#606060"}}},{from:50,to:70,color:"#dff0d8",label:{text:"Good",style:{color:"#606060"}}},{from:70,to:80,color:"rgba(68, 170, 213, 0.1)",label:{text:"Very Good",style:{color:"#606060"}}},{from:80,to:100,color:"#d9edf7",label:{text:"Excellent",style:{color:"#606060"}}}]},plotOptions:{line:{dataLabels:{enabled:!1},enableMouseTracking:!1}},series:n}),$("#"+t+" text").last().html("Programming Geek").click(function(e){e.preventDefault(),window.location="http://www.programminggeek.in"})},e.formatData=function(e){for(var t=[],n=0;n<e.length;n++)t.push(parseInt(e[n].s));return t},e.getRankSeries=function(t){for(var n=[],s=0;s<t.length;s++){if(t[s].u==e.user.username){var r={y:parseInt(t[s].s),marker:{symbol:"url(./assets/images/sun.png)"}};n.push(r)}else n.push(parseFloat(t[s].s));console.log(t[s].u+"  "+t[s].s+"  "+e.user.username)}var o=[{name:"Rank Graph ("+e.exam+")",data:n}];return o},e.getDonutData=function(){e.getCorrect()&&e.donutData.push(["Correct Answer ",e.getCorrect()]),e.getInCorrect()&&e.donutData.push(["Incorrect Answer ",e.getInCorrect()]),e.getUnAnswered()&&e.donutData.push(["Unanswered ",e.getUnAnswered()])},e.countStarred=function(){for(var t=0,n=0;n<e.questions;n++)e.questions[n].star&&t++;return t},e.$on("$destroy",function(){s.cancel(e.timer)})}]);