angular.module("etest").controller("TCSVerbalTestController",["$scope","$rootScope","$mdToast","$stateParams","login","$http","$timeout","localStorageService","VerbalTest","$location","header",function(e,t,a,n,r,o,i,s,l,u,c){c.setTitle("e-test: Online TCS Verbal Ability Test for Free"),e.id=n.id,(e.id<=0||e.id>16||!e.id)&&u.path("/error"),e.loading=!1,t.logged=r.isLogged(),e.userTestData=[],e.userAllData=[],e.allUserData=[],e.cummulativeGraphType="spline",e.individualGraphType="3d column",e.logme=function(){r.login()},null==t.user,e.loadQuestion=function(){o({method:"GET",url:"./app/questions/question"+e.id+".json",params:{}}).then(function(a){if(console.log(a.data.question+"\n"+a.data.phrases),e.done=!0,e.question=a.data.question,e.phrase=a.data.phrases,e.time=600,e.minutes=10,e.seconds="00",e.title="Online TCS Verbal Ability Test",e.test=!0,e.loading=!0,console.log(e.loading),t.user){t.logged=!0,alertify.success("Loaded TCS Verbal Test"+n.id+"!");var r={username:t.user.username,test:e.id};l.getVerbalData(r,e)}else t.logged=!1,alertify.error("You are not logged in!");e.startTime()})["catch"](function(){})["finally"](function(){})},e.loadQuestion(),e.startTime=function(){e.time%60<10?(e.minutes=parseInt(e.time/60),e.seconds="0"+e.time%60):(e.minutes=parseInt(e.time/60),e.seconds=e.time%60),e.time>0?e.timer=i(e.startTime.bind(this),1e3):e.endTest(),e.time-=1},e.endTime=function(){e.time=0},e.endTest=function(){e.answer||(e.answer=""),e.count||(e.count=0),e.check(),e.visualize()},e.check=function(){var a=e.answer,n=50,r=(e.wordCount(a),e.capitalizationError(a));e.vleavetaking=100,e.vcaperror=0,e.vsalutation=100,e.mistakes=[],e.errors=[],e.salutationError(a)&&(e.vsalutation=0,n-=10,e.mistakes.push("You have not provided a proper salutation. Include a proper salutation e.g. 'Dear' ")),r>0&&(e.vcaperror=r,n-=10,e.mistakes.push("Please capitalize words as and when required. Number of capitalization errors : "+r)),e.unmatchedPhrases(e.phrase,a)>0&&(n-=20,e.mistakes.push("You have not included all the phrases in the email. Include all the phrases.")),e.leaveTakingError(a)&&(e.vleavetaking=0,n-=10,e.mistakes.push("You have not used a correct form of leave taking."),e.mistakes.push("     Recommended : "),e.mistakes.push("        Regards"),e.mistakes.push("        Thanks"),e.mistakes.push("        Thanks and regards")),n+=e.wordCount(a)<70?30:e.wordCount(a)<=90?40:35,e.wordCount(a)<50?(n=0,e.score=n,e.scoreRemark=e.scoreSuggestion(n)):(e.score=n,e.scoreRemark=e.scoreSuggestion(n)),e.countRemark=e.wordCountSuggestion(e.wordCount(a)),e.done=!0,e.test=!1,e.report=!0,t.title="Online TCS Verbal Ability Test : Perfomance Analysis";var o={username:t.user.username,score:e.score,test:e.id,words:e.count,phrases:e.phrasesPercent,salutation:e.vsalutation,leave:e.vleavetaking,caperror:e.vcaperror};e.spellingMistakes(e.answer),l.saveVerbalResult(o,e),e.userAllData.push({s:e.score,t:e.id}),e.userTestData.push({s:e.score})},e.wordCount=function(e){if(0==e.length)return e.length;var t=e.replace(/\s/g,"+"),a=t.replace(/^\s/g,"+"),n=a.replace(/\+*$/gi,""),r=n.replace(/\++/g," ");return r.split(" ").length},e.setCount=function(){e.time?e.count=e.wordCount(e.answer):e.endTest()},e.capitalizationError=function(e){if(e)return 0;var t=0;t+=e.length-e.replace(" i ","  ").length,e=e.replace("Mr.",""),e=e.replace("Ms.","");for(var a=e.trim().split("."),n=0;n<a.length;n++)a[n]=a[n].trim(),a[n].charAt(0)+""!=(a[n].charAt(0)+"").toUpperCase()&&t++;return t},e.salutationError=function(e){return e.indexOf("Dear")<0},e.leaveTakingError=function(e){return e.indexOf("Thanks")<0&&e.indexOf("Thanks and regards")<0&&e.indexOf("Regards")<0},e.wordCountSuggestion=function(e){return 50>e?"Bad! You email should contain at least 50 words.":70>=e?"Good! You can add a few more words.":80>=e?"Excellent! Your email is of precise length.":"Bad! Your email is too lengthy. Avoid making it too long."},e.unmatchedPhrases=function(t,a){t=t.trim().toUpperCase().split("-"),a=a.toUpperCase();for(var n=0,r=0;r<t.length;r++)a.indexOf(t[r].trim())<0&&n++;return e.phrasesPercent=100*(t.length-n)/t.length,n},e.scoreSuggestion=function(e){return 50>e?"Bad! Improve your score.":80>e?"Good! Missed something? Here are a few tips to remember : http://goo.gl/AouxeV":90>e?"Very Good! Your chance of geeting seleceted is high. Improve your score.":"Excellent! You will qualify Verbal Ability Test. Avoid any spelling or grammatical error."},e.retakeTest=function(){u.path("Verbal"),i(function(){u.path("Verbal/TCS/Set/"+e.id)},100)},e.printReport=function(){window.print()},e.spellingMistakes=function(t){return null==t||0==t.trim().length?void e.mistakes.push("You made 0 spelling mistakes."):(t=t.replace(/(^\s*)|(\s*$)/gi,""),t=t.replace(/[ ]{2,}/gi," "),t=t.replace(/\n /," "),void l.spellCheck(t,e))},e.visualize=function(){$("ul li").codexgraph({knobcolor:"#14b9d5",fillcolor:"#fff",textcolor:"#000"}),$("#visualization ul li:first").trigger("click"),i(function(){e.draw("3d column"),e.drawAll("spline"),e.drawRankGraph("line"),window.scrollTo(0,0)},100)},t.saveAnswer=function(){return e.count<50?void alertify.error("To save, your answer must contain at least 50 word!"):void o({method:"POST",url:t.urlPrefix+"etest/setjson.php",params:{username:e.user.username,answer:e.answer,score:e.score,test:e.id}}).then(function(e){console.log(e.data+" data saved!"),alertify.success("Answer Saved")})["catch"](function(e){console.log(e.message)})["finally"](function(){})},e.draw=function(t){var a="Performance Analysis",n="TCS Verbal Test Set"+e.id,r="Time ( Test Taken)",o=" Performance (%)",i=[{name:"TCS Verbal Test Set"+e.id,data:e.formatData(e.userTestData)}];if("3d column"==t){var s={renderTo:"container",type:"column",margin:75,options3d:{enabled:!0,alpha:15,beta:15,depth:50,viewDistance:25}};e.cummulativeRanking(s,"individualRanking",i,a,n,r,o)}else e.cummulativeRanking({type:t},"individualRanking",i,a,n,r,o);$(window).scrollTop($("#individualRanking").offset().top)},e.drawAll=function(t){var a="Performance Analysis",n="all TCS verbal test",r="Time ( Test Taken)",o=" Performance (%)";if("3d column"==t){var i={renderTo:"container",type:"column",margin:75,options3d:{enabled:!0,alpha:15,beta:15,depth:50,viewDistance:25}};e.cummulativeRanking(i,"cummulativeRanking",e.getUserAllSeries(e.userAllData),a,n,r,o)}else e.cummulativeRanking({type:t},"cummulativeRanking",e.getUserAllSeries(e.userAllData),a,n,r,o);$(window).scrollTop($("#cummulativeRanking").offset().top)},e.drawRankGraph=function(t){var a="Rank Analysis",n="",r="Rank",o=" Average Score (%)";if("3d column"==t){var i={renderTo:"container",type:"column",margin:75,options3d:{enabled:!0,alpha:15,beta:15,depth:50,viewDistance:25}};e.cummulativeRanking(i,"overallRanking",e.getRankSeries(e.allUserData),a,n,r,o)}else e.cummulativeRanking({type:t},"overallRanking",e.getRankSeries(e.allUserData),a,n,r,o);$(window).scrollTop($("#overallRanking").offset().top)},e.cummulativeRanking=function(e,t,a,n,r,o,i){$("#"+t).highcharts({chart:e,title:{text:n},subtitle:{text:r},xAxis:{categories:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],title:{text:o}},yAxis:{title:{text:i},min:0,minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null,plotBands:[{from:0,to:50,color:"#f2dede",label:{text:"Poor",style:{color:"#606060"}}},{from:50,to:70,color:"#dff0d8",label:{text:"Good",style:{color:"#606060"}}},{from:70,to:80,color:"rgba(68, 170, 213, 0.1)",label:{text:"Very Good",style:{color:"#606060"}}},{from:80,to:100,color:"#d9edf7",label:{text:"Excellent",style:{color:"#606060"}}}]},plotOptions:{line:{dataLabels:{enabled:!1},enableMouseTracking:!1}},series:a}),$("#"+t+" text").last().html("Programming Geek").click(function(e){e.preventDefault(),window.location="http://www.programminggeek.in"})},e.AllTestGraph=function(t){e.cummulativeRanking(t,"cummulativeRanking")},e.testGraph=function(t){e.cummulativeRanking(t,"individualRanking")},e.formatData=function(e){for(var t=[],a=0;a<e.length;a++)t.push(parseInt(e[a].s));return t},e.getAllUserData=function(){},e.getUserAllSeries=function(e){for(var t=[],a=0;14>a;a++){var n=[];for(j=0;j<e.length;j++)parseInt(e[j].t)==a+1&&n.push(parseInt(e[j].s));var r={name:"Set"+(a+1),data:n};t.push(r)}return t},e.getRankSeries=function(t){for(var a=[],n=0;n<t.length;n++){if(t[n].u==e.user.username){var r={y:parseInt(t[n].s),marker:{symbol:"url(./assets/images/sun.png)"}};a.push(r)}else a.push(parseInt(t[n].s));console.log(t[n].u+"  "+t[n].s+"  "+e.user.username)}var o=[{name:"Rank Graph (Set"+e.id+")",data:a}];return o},e.maximum=function(){},e.updateData=function(){},e.$on("$destroy",function(){i.cancel(e.timer)})}]);